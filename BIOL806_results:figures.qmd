---
title: "BIOL806_results/figures"
format: pdf
---

## Results

### Data Organizing and Cleaning

All codes to creating the tables, figures and data frames
can be found here
<https://github.com/1006kay/Biol_806_FinalProject.git> on
github.

```{r, message = FALSE, warning= FALSE, echo=FALSE}
#Load Packages
library(tidyverse)
library(readxl)
library(purrr)
library(ggplot2)
library(dplyr)
library(lubridate)
library(kableExtra)

RT30d_data <- read_excel("~/Desktop/Master Program/Fairchild Data /RT30d_data.xlsx")
MY30d_data1 <- read_excel("~/Desktop/Master Program/Fairchild Data /MY30d_data1.xlsx")
```

### Above and Below Groups from Mean Rumination Time in the Last Week of Pregnancy

To account for parirty, primiparous (1st lactation) and
multiparous (2â‰¥ lactation) cows were grouped together to
obtain mean rumination time for their last week of pregnancy
(LWP), which consisted of days -7 to -1 relative to calving
(day 0). For primiparous cows, the mean RT in the LWP was
489.99 min/24hr. For multiparous cows, the mean RT in the
LWP was 473.12 min/24hr. In table 1, it shows the cows that
were enrolled in the data collection process that had an
individual mean RT that was below parity (primi- or
multiparous) average. Also included in table 1, is the
lactation each cow is currently in. The sample size of cows
placed in the below group is *n* = 16. Table 2 includes the
same metrics listed in table 1, however this table shows the
cows that had a greater mean RT in the LWP than the parity
RT average. The sample size of cows placed in the above
group is *n* = 18.

```{r, echo=FALSE, tab.cap="This table shows the distribution of cows that belong in the below group based off of their rumination time (RT) in their last week of pregnancy. The primiparous cows (n=5) were grouped together to find the primiparous mean RT (4.89.99 min/24hr) and the multiparous cows (n=29) were grouped together to find the multiparous mean RT (473.12 min/24hr)."}
#1. Finding individual RT (24hr) in last week of pregnancy
ind_average24rt <- RT30d_data %>%
  select(`Cow ID`, Day, `RT 24hr`) %>% 
  filter(Day %in% c(-7, -6, -5, -4, -3, -2, -1)) %>%
  distinct() %>% #removes identical rows
  group_by(`Cow ID`) %>%
  summarise(`meanRT-1wk` = mean(`RT 24hr`)) #gets avg(mean) RT in -7 to -1d 

#2. Finding mean RT based off parity (primi = 1, multi = 2<), then creating above or below groups 
MYlactation <- MY30d_data1 %>%
  select(`Cow ID`, Lactation)%>%
  distinct() #data frame creating cow id and lactation (parity)

#Primi
ind_average24rt.1 <- left_join(MYlactation, ind_average24rt, by = "Cow ID") #combines lactation status to 24 hr RT data by Cow ID
primi_ind_avg <- ind_average24rt.1 %>%
  filter(Lactation == 1) %>% #separating primi cows
  mutate(mean_grp1avg_rt24 = mean(`meanRT-1wk`), 
         comparison = case_when(`meanRT-1wk` > mean_grp1avg_rt24 ~ "above",
      `meanRT-1wk` < mean_grp1avg_rt24 ~ "below",
      TRUE ~ "equal")) #indicates if ind cow falls above or below grp avg for primiparous cows
#multi
multi_ind_avg <- ind_average24rt.1 %>%
  filter(Lactation > 1) %>% #separating mutli cows
  mutate(mean_grp1avg_rt24 = mean(`meanRT-1wk`), 
         comparison = case_when(`meanRT-1wk` > mean_grp1avg_rt24 ~ "above",
      `meanRT-1wk` < mean_grp1avg_rt24 ~ "below",
      TRUE ~ "equal")) #indicates if ind cow falls above or below grp avg for multiparous cows

#combining both primi + multi data frames
ind_average24rt.2 <- rbind(primi_ind_avg, multi_ind_avg)
grp_avg_final <- ind_average24rt.2 %>%
  mutate(parity = case_when(Lactation <= 1 ~ "primi", Lactation > 1 ~ "multi"))

#Cow ID and Parity data frame
cow_parity <- grp_avg_final %>%
  select(`Cow ID`, parity)


grp1below <- grp_avg_final %>%
  filter(comparison == "below")

colnames(grp1below)[3] <- c("Mean Ind. RT in LWP")
colnames(grp1below)[4] <- c("Mean Parity RT in LWP")
colnames(grp1below)[5] <- c("Group")
colnames(grp1below)[6] <- c("Parity")

kable(grp1below)
```

```{r, echo=FALSE, tab.cap="This table shows the distribution of cows that belong in the above group based off of their rumination time (RT) in their last week of pregnancy. The primiparous cows (n=5) were grouped together to find the primiparous mean RT (4.89.99 min/24hr) and the multiparous cows (n=29) were grouped together to find the multiparous mean RT (473.12 min/24hr)."}
grp1above <- grp_avg_final %>%
  filter(comparison == "above")

colnames(grp1above)[3] <- c("Mean Ind. RT in LWP")
colnames(grp1above)[4] <- c("Mean Parity RT in LWP")
colnames(grp1above)[5] <- c("Group")
colnames(grp1above)[6] <- c("Parity")

kable(grp1above)
```

In figure 1, shows the distribution of cows individual
rumination time after assigning groups, above or below,
based off of the mean RT in the last week of pregnancy.
Based off of figure, the above group shows that there are no
outliers, the overall shape has some symmetric distribution
of individual mean RT since the median line is centered
while the whiskers are not evenly distributed, and has a
higher median when compared to the below group. As for the
below group, it is showing two outliers below the median of
the group, as well as the shape of this group is not
symmetric as the median is not centered but the whiskers are
similar in length.

```{r, echo=FALSE, fig.cap="The box plot figure above shows the individual cow mean rumination time (min/24hr) in the last week of pregnancy (LWP) for both the above and below groups."}
above_below_bp <- ggplot(grp_avg_final, aes(x = comparison, y = `meanRT-1wk`, 
                             colour = comparison)) +
  geom_boxplot() +
  theme_light() +
  scale_color_manual(values = c("cadetblue3", "coral1")) +
  labs(x = "Group", 
       y = "Individual Cow Mean Rumination Time 
       (min/24hr) in the LWP",
       color = NULL) +
  theme(axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12))

print(above_below_bp)
```

### Mean Rumination Time in the Week Before and Week After Calving

In figure 2, it shows mean rumination time (min/24hr) by day
relative to calving. The below group has decreased mean
rumination time from day -7 to day 1, when compared to the
above group. After calving at day 0, the below group still
has a slight decrease in mean rumination time is comparison
to the above group. However, at day 2, both teh above and
below groups have a similar mean rumination time just above
425 min/24hr. Both groups have a similar pattern of mean
rumination time throughout, meaning around calving,
rumination time decreases, then increases days after.

```{r, echo=FALSE, fig.cap="This time series plot is showing the mean rumination (RT) (min/24hr) from the above and below group from 7 days before and 7 days after relative to calving (day 0)."}
#0. New data frames were created with all RT data for above and below groups for future analysis
grp1above_dataset <- RT30d_data %>%
  filter(`Cow ID` %in% c(976, 989, 1047, 1083, 1103, 1107, 1141, 1148, 1189, 1192, 1200,
                         1203, 1205, 1206, 1207, 1209, 1252, 1253))
grp1below_dataset <- RT30d_data %>%
  filter(`Cow ID` %in% c(953, 963, 1048, 1065, 1143, 1150, 1157,
                         1191, 1193, 1195, 1199, 1208, 1215, 1245, 1246, 1250))


#1. Creating data frame of 24hr RT for above group from -7 to 7 days relative to calving
grp1above_RT_LWP <- grp1above_dataset %>%
  select(`Cow ID`, Day, `RT 24hr`) %>%
  filter(Day %in% c(-7, -6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6, 7)) %>%
  distinct()

#2. Finding the mean 24hr RT for each day from the above group
grp1above_RT_LWP.1 <- grp1above_RT_LWP %>%
  group_by(Day) %>%
  summarise(above = mean(`RT 24hr`))

#3. Creating data frame of 24hr RT for below group from -7 to 7 days relative to calving
grp1below_RT_LWP <- grp1below_dataset %>%
  select(`Cow ID`, Day, `RT 24hr`) %>%
  filter(Day %in% c(-7, -6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6, 7)) %>%
  distinct() 

#4. Finding the mean 24hr RT for each day from the below group
grp1below_RT_LWP.1 <- grp1below_RT_LWP %>%
  group_by(Day) %>%
  summarise(below = mean(`RT 24hr`))

#5. Combining both above and below groups data frames to create long data frame to graph in ggplot
grp1_a_b_LWP <- left_join(grp1above_RT_LWP.1, grp1below_RT_LWP.1, by = "Day")
grp1_a_b_LWP_long <- grp1_a_b_LWP %>%
  pivot_longer(cols = c(above, below), 
               names_to = "group", values_to = "mean_RT")
#need to pivot_longer data to plot both above and below groups

#6. Creating ggplot point graph to visualise mean RT from -7d to 7d for the above group and below group
mean_a_b_rt <- ggplot(grp1_a_b_LWP_long, aes(x = Day, y = mean_RT, color = group)) +
  geom_point() +
  geom_line(aes(group = group)) +
  scale_x_continuous(breaks = -7:7) + #need this for xaxis in days
  scale_color_manual(values = c("cadetblue3", "coral1")) +
  theme_light() +
  labs(y = "Mean Rumination Time (min/24hr)", color = NULL) +
  theme(axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12))

print(mean_a_b_rt)
```

### Above and Below Groups Milk Yield (MY) in first 30 days in milk (DIM)

```{r, echo=FALSE, fig.cap="This time series plot shows the mean weekly milk yield (lbs) for each individual cow (primi- and multiparous) in the above group in the first five weeks into lactation. Calving is at the beginning of week 1."}
#1. Assign groups (above or below) to MY data
cowid_group <- grp_avg_final %>%
  select(`Cow ID`, comparison, parity)
MY30d_group1 <- left_join(MY30d_data1, cowid_group, by = "Cow ID")
#assigning group to MY data

#2. Creating seperate data frames for above and below group
grp1MY_above <- MY30d_group1 %>%
  filter(comparison == "above") %>%
  mutate(`Cow ID` = as.factor(`Cow ID`)) #for ease of plotting in ggplot

grp1MY_below <- MY30d_group1 %>%
  filter(comparison == "below") %>%
  mutate(`Cow ID` = as.factor(`Cow ID`))

#3. Graphs in ggplot point for above and below groups to visualise weekly mean MY in the first 5 weeks of lactation
#above
above_my <- ggplot(grp1MY_above, aes(x = Week, 
                         y = `Weekly MY`, 
                         color = `Cow ID`)) +
  geom_point() +
  geom_line() +
  theme_light() +
  labs(y = "Weekly Milk Yield (lbs)") +
  theme(axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12),
        legend.text = element_text(size = 7)) +
  guides(color=guide_legend(nrow = 10, byrow = FALSE, order = 1))


print(above_my)
```

```{r, echo=FALSE, fig.cap="This time series plot shows the mean weekly milk yield (lbs) for each individual cow (primi- and multiparous) in the below group in the first five weeks into lactation. Calving is at the beginning of week 1."}
#below
below_my <- ggplot(grp1MY_below, aes(x = Week, 
                         y = `Weekly MY`, 
                         color = `Cow ID`)) +
  geom_point() +
  geom_line() +
  theme_light() +
  labs(y = "Weekly Milk Yield (lbs)") +
  theme(axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12),
        legend.text = element_text(size = 7)) +
  guides(color=guide_legend(nrow = 10, byrow = FALSE, order = 1))

print(below_my)
```

```{r, echo=FALSE, fig.cap="In this time series plot, it shows the mean milk yield (lbs) for the above and below groups (primi- and multiparous cows) in the first 30 days in milk (DIM). Calving is at day 0."}
#4. Finding mean MY for the above and below group
#above
avgaboveMY <- grp1MY_above %>%
  select(`Cow ID`, `Days Since Last Calving`, `Total Yield`) %>%
  group_by(`Days Since Last Calving`) %>%
  summarise(above = mean(`Total Yield`))

#below
avgbelowMY <- grp1MY_below %>%
  select(`Cow ID`, `Days Since Last Calving`, `Total Yield`) %>%
  group_by(`Days Since Last Calving`) %>%
  summarise(below = mean(`Total Yield`))

#5. Combining above and below MY data to graph
MY_above_below <- left_join(avgaboveMY, avgbelowMY, by = "Days Since Last Calving") 
MY_above_below_long <- MY_above_below %>%
  pivot_longer(cols = c(above, below),
               names_to = "group", values_to = "mean_my")


#6. Creating ggplot point graph on above and below mean MY in the first 30 days in milk (DIM)
mean_my_a_b <- ggplot(MY_above_below_long, aes(x = `Days Since Last Calving`, 
                                y = mean_my, 
                                color = group)) +
  geom_point() +
  geom_line() +
  scale_color_manual(values = c("cadetblue3", "coral1")) + 
  theme_light() +
  labs(x = "Days in Milk", 
       y= "Mean Milk Yield (lbs)", 
       color = NULL) +
  theme(axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12))

print(mean_my_a_b)
```
